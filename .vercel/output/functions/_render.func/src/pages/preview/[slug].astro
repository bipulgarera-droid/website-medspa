---
export const prerender = false; // SSR for dynamic routes

import MainLayout from '../../layouts/MainLayout.astro';
import MainApp from '../../components/react/MainApp';
import { getProspectBySlug } from '../../lib/supabase';

// Get the slug from the URL
const { slug } = Astro.params;

// Fetch prospect data from Supabase
let prospectData = null;
if (slug) {
  prospectData = await getProspectBySlug(slug);
}

// Use prospect data or defaults
const pageTitle = prospectData?.business_name 
  ? `${prospectData.business_name} - Advanced Skin Care`
  : 'Rondebosch Laser - Advanced Skin Care';

// Transform for React component
const reactProspectData = prospectData ? {
  businessName: prospectData.business_name,
  logoUrl: prospectData.logo_url,
  phone: prospectData.phone,
  email: prospectData.email,
  address: prospectData.address,
} : undefined;
---

<MainLayout title={pageTitle}>
  <MainApp client:load prospectData={reactProspectData} />
</MainLayout>
